---
title: Testing Vue in Laravel with Jest - let's make it a little more easy
release_date: Today
slug: vue-testing-in-laravel
excerpt: >-

    Laravel offers an awesome testing environment for php already, but if use Vue.js for much of your frontend, you most likely have big blindspot if you don't test that too.
    
    Let me try to simplify the initial setup of testing Vue single file components in a dafault Laravel 6-8 application.
tags:
  - Frontend
  - Dev Ops
  - Testing
header_image: >-
  https://res.cloudinary.com/simonvomeyser/image/upload/v1605361788/testing-vue/header.jpg
list_image: >-
  https://res.cloudinary.com/simonvomeyser/image/upload/v1605362168/testing-vue/header_small.png
---

<tldr> 

In a hurry? Just do this and try your luck! ðŸ¤ž

```bash

npm install -â€”save-dev jest vue-jest @vue/test-utils babel-core@^7.0.0-bridge.0 @babel/preset-env

npx vue-tests-laravel-setup

node_modules/bin/jest

```

You should see the passing example test which got added by `vue-tests-laravel-setup`. No you can simply add a test script to your `package.json` file.

```js
{
    // ...
    "scripts": {
        //...        
        "test" : "jest"
        //...        
    },
    // ...
}
```

Now you can run `npm run test`. Happy testing :)

</tldr>

Okay, let's admit it: Testing Laravel in 2020 is an outright joy, but setting up tests for Vue.js is a fight. 

Since JavaScript and NPM packages change all the time, most blogposts and tutorials are likely out of date, including this one. I greet you future-person, do we have jetpacks yet? ðŸš€ðŸ‘‹. Be cautious if it's 2030 when you are reading this, some things might have changed.

So how to set up Vue testing in Laravel? Is the only option to Google-deep-dive and assemble your own Frankenstein's Assertion Webpack Babel Monster&trade;? 

In this post I will try to make the setup easy, I also wrote a **todo link**little npm package to make the setup a cinch. 

In my opinion, setting up tests for your frontend should be easy. Why? Because:

> If it's hard to set up tests, nobody will write them

## Let's start: Laravel, Vue and prerequisites

There are a million ways you could have configured your Laravel and Vue, so foreseeing all of them is a rather worthless endeavour. Also be cautious, if this post is older then 6-12 month, things change so quickly.

Here are a few things that need to be given: 

### Laravel

This tutorial assumes a rather untouched setup, so you most likely use `laravel-mix` with a few configurations. If you toyed a lot with your build setup there might by things that blow up.

I tested this with most of my projects though, and it worked flawlessly going back to Laravel 5.6.

### Vue

This tutorial deals with **single file components only** and is meant **only for Vue 2.x currently**.

As soon as `laravel-mix` in version 6.x is out of beta I will have a look at the setup for Vue 3 and hopefully make it work :) 

 
## Just install 500 NPM packages

Most tutorials of this kind just throw a lot of `npm install` statements at you - and there is good reason for it. Explaining what all these packages do is cumbersome, and most people don't have the time to read an in depth explanation anyways.
 
> If you think "just tell me what to do" read the <tldr-link>summary</tldr-link>

From here I will try to cover a little more details here, but the **todo link package I created** already does everything for you, so jump there if you are in a hurry. It will get quite nerdy from here!

**lets get nerdy gif**
 

## Basics, we need the basics

Let's start simple, we will need `jest` as our testrunner, that's the JavaScript equivalent of PHPUnit. 

<sidenote heading="Why use Jest and not Mocha?">

We also will need `vue-test-utils`: Think of those like special assertions for vue.

```bash
npm install jest vue-test-utils
```

There are essentially two test runners/frameworks that are recommended by the [Vue Docs](https://vuejs.org/v2/guide/testing.html#Frameworks): Mocha and Jest. Since I also work with React I have experience with Jest. There is a lot already build in, which means less to worry about, right?

To admit it was also really hard for me to just get up and running with mocha and mocha webpack. There is a good [Laracasts video series](https://laracasts.com/series/testing-vue), but nothing seem to work with newer version of `laravel-mix`.

In theory, you could just use your existing Webpack configuration generated by Laravel Mix, but in practice this turned out to be configuration nightmare. 

Smarter people might have made it work though (add link **todo**)

</sidenote>

Don't forget here, that we obviously need *Vue.js* itself, and it's template compiler for the single file components. If you haven't already, run: 

```bash
npm install vue vue-template-compiler
```
 
## Into the config abyss

It would be awesome if we could simply write our first test now right? Sadly, JavaScript says no.

// javascript says no gif?
// I dont think so gif (todo)

The *first* of many configs we need is the one for `jest` itself ðŸ™„. Granted, `PHPUnit` also has a really spiky config file, so I'll take back the eye-roll.

You can throw your jest config into a key in your `package.json`, but I prefer to create a `jest.config.js` since it's easier to parse.

Create a file in your root with the following content:

```js
// jest.config.js
module.exports = {
    // Where are your vue tests located?
    "roots": [
        "<rootDir>/tests/Vue"
    ],
    // vue: transform vue with vue-jest to make jest understand Vue's syntax
    // js: transform js files with babel, we can now use import statements in tests
    "transform": {
        ".*\\.(vue)$": "<rootDir>/node_modules/vue-jest",
        "^.+\\.js$": "<rootDir>/node_modules/babel-jest"
    }
    // (optional) with that you can import your components like
    // "import Counter from '@/Counter.vue'"
    // (no need for a full path)
    "moduleNameMapper": {
        "^@/(.*)$": "<rootDir>/resources/js/$1"
    },
}
```

I would recommend creating a `setup.js` file where you can preparations for all test.

For that reason, my (**link**)npm-package creates that file by default. I will skip it here though, this article is nerdy enough.

<sidenote heading="Hey, but I want a setup.js file!">

Ah, you are instantly 7% more cool! 

It makes sense to have that file since we will need a lot later!

Just add the following lines to your `jest.config.js`:

```js
"setupFilesAfterEnv": [
    "<rootDir>tests/Vue/setup.js"
],
```

Of course, you need to create that (empty) file in the `test/Vue/` or jest will vomit a lot of errors on your shoes.

</sidenote>



## Woha, now we can create tests?

Almost. Not quite. Now it gets ugly.

First of all note, that `jest` is a running on node, and in node, as of now we can't use our beloved `import ... from ...` statements. That's a problem since all of your single file components will likely use these statements, and it would be nice to write tests the same way.

That's the reason, libraries like `vue-jest` already come bundled with `bable`, a mighty tool used to transform JavaScript. 

And... if we use babel, we need another config file to tell what we actually want to transform.

**opra you get a config file, and you get a conifg file**


## In babel land

The least complicated way to do this is to simply at a `.babelrc` file in your repo like this:

```json
{
  "presets": ["@babel/preset-env"]
}
```

That will work since in normal Laravel installs, `laravel-mix`, the mothership Laravel asset building,  takes care of everything, and it is ignoring this file. If you want to only add transformations for testing, do it like this, even though it is not necessary in most cases.:

```json
{
    "env": {
        "test": {
            "presets": [
                [
                    "@babel/preset-env"
                ]
            ]
        }
    }
}
```

This tells `babel-jest` and `vue-jest`: "Be a good kid and transform all the test code we write before testing. Use the things this preset of `babel` to make it as compatible as possible - and please just work".

I'll leave it at that, we would actually only need a few select plugins and not a whole preset, but this post is nerdy enough.

## Just oooone more thing

We are almost there I promise. The last problem we have to solve is that newer version of `jest` as well as `laravel-mix` use a newer version of `babel` that is incopatbile with `vue-jest`. I'll make it short, there is a plugin for that, called `bable-bridge` described in the `vue-jest` **link**docs.

    
```bash
npm install --save-dev babel-core@bridge
```

Believe it or not, we can **finally** write our first test.

**vue needs babel need jest needs babel bridge needs babel config image**

## The first test, keep it simple

For the first test I would recommend you keep it simple. There are a lot of other problems that can happen even though `jest` now finally knows how to handle your tests and vue files.

Common problems are:

- Using other (global) components in the component under test
- Plugins
- Global functions you added like `tans()` or `route()`
- Ajax-Calls made by a component
- Using a global event emitter

I plan on writing a post about mitigating some of these problems, but for this post a simple component should be enough. After all, the topic is the test *setup*. Just keep in mind that there are still roadblocks ahead.

In your `resources/js/` folder create the following file:

```vue
// resources/js/Counter.vue
<template>
    <div>
        <h1>Count: {{ counter }}</h1>

        <button @click="counter++" jest="increment-button">+1</button>
    </div>
</template>

<script>
export default {
    data() {
        return {
            counter: 0,
        }
    }
}
</script>
```

The typical simple and useless counter component, but good to see, if our setup works.
 
Next step, create your test under `tests/js/`

```js
// tests/js/Counter.spec
import { mount } from '@vue/test-utils'
import Counter from '../../resources/js/Counter.vue'

describe('Counter.vue', () => {
    it('increments counter', () => {
        const wrapper = mount(Counter);

        expect(wrapper.vm.counter).toBe(0);

        wrapper.find('[jest="increment-button"]').trigger('click')

        expect(wrapper.vm.counter).toBe(1);
    })
})
```

Now you should be able to run jest via `node_modules/.bin/jest` and see the following output:

**add image or gif about the jest test**

To make it a little simpler add a script to your `package.json` file 

```js
// package.json
{
    // ...
    "scripts": {
        //...        
        "test" : "jest"
        //...        
    },
    // ...
}
```

## Still having problems?

In almost all of my projects and for the "beta tester" I annoyed with this tutorial (**toto insert people**) It did make the setup a chinch. If you still experience errors, here are a few options:

- Consider using my **todo link** package for the setup, there is much less room for typos
- Install the testing packages with the compatible versions as shown in the <tldr-link>TL;DR</tldr-link> 
- Submit an issue or a pull request to the **todo**Repo - or simply **todo**Contact me, let's make vue testing more approachable together


## Wrap it up ðŸŒ¯

This post shows that there is a lot involved in simply getting *started* with Vue.js tests in your Laravel App.

Even though there are still many roadblocks from here, this setup might help some folks to get started.
 
I hope to have contributed at least a small amount to help developing more resilient and less error prone frontends.

So long, Cherrio ðŸ‘‹
Simon




