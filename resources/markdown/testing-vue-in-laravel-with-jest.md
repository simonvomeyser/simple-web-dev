---
title: Testing Vue in Laravel with Jest - let's make it a little more easy
release_date: Today
slug: vue-testing-in-laravel
excerpt: >-

    Laravel offers an awesome testing environment for php, but if use Vue.js for much of your frontend, you most likely have big blindspot if you don't test that too.
    
    I try to ease the initial setup of testing Vue single file components in a dafault Laravel 6-8 Application.
tags:
  - Frontend
  - Dev Ops
  - Testing
header_image: >-
  https://res.cloudinary.com/simonvomeyser/image/upload/v1588611570/dont-use-ftp/dont-use-ftp-list-header-image.png
list_image: >-
  https://res.cloudinary.com/simonvomeyser/image/upload/v1588611570/dont-use-ftp/dont-use-ftp-list-header-image.png
---

Okay, let's admit it: Testing Laravel itself is an outright joy, but setting up tests for Vue.js components in your frontend is still quite a fight. Laravel can't provide an out-of-the-box solution, so you need to Google-Dive and assemble your own Frankenstein's Assertion Webpack Babel Monster. 

JavaScript and NPM packages change all the time, so most blogposts and tutorials are likely out of date (like this one, I greet you, future person ðŸ‘‹).

I still hope to help with my "currently working 2020 Laravel 8.x solution" here.
  
I also wrote and will show you a little package making setting everything up a cinch. Maybe this will still work at the time you are reading this. Why? Because:

> If it's hard to set up tests, nobody will write them
 

<tldr> 

In a hurry? Just do this and try your luck! ðŸ¤ž

```bash

npm install -â€”save-dev jest vue-jest @vue/test-utils babel-core@^7.0.0-bridge.0 @babel/preset-env

npx vue-tests-laravel-setup

node_modules/bin/jest

```

You should see the passing example test which got added by `vue-tests-laravel-setup`. No you can simply add a test script to your `package.json` file.

```js
{
    // ...
    "scripts": {
        //...        
        "test" : "jest"
        //...        
    },
    // ...
}
```

Now you can run `npm run test`. Happy testing :)

</tldr>

## Let's start: Laravel, Vue and prerequisites

I could only test this tutorial with newer versions of Laravel, starting from 6.x, but it should still work with a **fresh install** of 5.6.

Currently this article is only talking about Vue 2.x, but the created npm package will try to detect your installed vue version and make changes accordingly.

I of course can't know all the ways you configured your already running projects. If you encounter an error and you think a solution would help a lot of people let's [figure something out together](mailto:info@simonvomeyser.de) and get more people into testing Vue in Laravel :) 

**todo**Tell them that vue needs to be installed (vue and template compoiler)

**todo**Tell them about Single file components
**todo**Tell them about vue three

## ...and why use Jest and not Mocha?

There are essentially two test runners that are recommended by the **toodo vue docs**: Mocha and Jest. Since I also work with React I like Jest a lot. Since there is a lot already build in that's one thing less to worry about, right?

<sidenote heading="Maybe I'm too stupid for Mocha">

To admit it was also really hard for me to just get up and running with mocha and mocha webpack. There is a good **todo link laracasts video series** about the setup, but nothing seem to work with newer version of Laravel Mix.

In theory, you could just use your existing Webpack configuration generated by Laravel Mix, but in practice this turned out to be configuration nightmare. 

Smarter people might have made it work though (add link **todo**)

</sidenote>
 
## Okay, just install these 500 NPM packages

Most tutorials of this kind just throw a lot of `npm install` statements at you - and there is good reason for it. Explaining what all these packages do is cumbersome, and most people don't have the time to read an in depth explanation anyways.
 
If you "just want to make the damn thing work" I understand, we can still be friends: Take look at the <tldr-link>summary</tldr-link>.

I will try to cover at least a little more nerdy details here, but the **todo link package I created** already does everything for you, so jump there if you are in a hurry, it will get quite nerdy from here!

**lets get nerdy gif**
 

## Basics, we need the basics

Let's start simple, we will need `jest` as our testrunner, that's the JavaScript friend of PHPUnit. We also will need `vue-test-utils`: Think of those like special assertions for vue.

```bash
npm install jest vue-test-utils
```

Don't forget here, that we obviously need *vue* itself, and it's template compiler for the single file components. If you haven't already, run: 

```bash
npm install vue vue-template-compiler
```
 
## Into the config abyss

It would be awesome if we could simply write our first test now right? Sadly, JavaScript says no.

// javascript says no gif?
// I dont think so gif (todo)

The first config we need is the config for `jest` itself. (Granted, `PHPUnit` also needs a really spiky config file)

You can throw your jest config into a key in your `package.json`, but I prefer to create a `jest.config.js` file with the following content:

```js
// jest.config.js
module.exports = {
    // the extensions  load these extension
    "moduleFileExtensions": [
        "js",
        "json",
        "vue"
    ],
    // (optional) with that you can import your components like
    // import Counter from '@/Counter.vue'
    // (no need for a full path)
    "moduleNameMapper": {
        "^@/(.*)$": "<rootDir>/resources/js/$1"
    },
    // Where are your vue tests located?
    "roots": [
        "<rootDir>/tests/Vue"
    ],
    // vue: transform vue with vue-jest to make jest understand Vue's syntax
    // js: needed e.g to use import statements in tests
    "transform": {
        ".*\\.(vue)$": "<rootDir>/node_modules/vue-jest",
        "^.+\\.js$": "<rootDir>/node_modules/babel-jest"
    }
}
```

I would recommend creating a `setup.js` file where you can preparations for all test.

For that reason, my (**link**)npm-package creates that file by default. I will skip it here though, this article is nerdy enough.

<sidenote heading="Hey, but I want a setup.js file!">

Ah, you are instantly 7% more cool! 

It makes sense to have that file since we will need a lot later!

Just add the following lines to your `jest.config.js`:

```js
"setupFilesAfterEnv": [
    "<rootDir>tests/Vue/setup.js"
],
```

Of course, you need to create that (empty) file in the `test/Vue/` or jest will vomit a lot of errors on your shoes.

</sidenote>



## Woha, now we can create tests?

Almost. Not quite. Now it gets ugly.

First of all note, that `jest` is a running on node, and in node, as of now we can't use our beloved `import ... from ...` statements. That's a problem since all of your single file components will likely use these statements, and it would be nice to write tests the same way.

That's the reason, libraries like `vue-jest` already come bundled with `bable`, a mighty tool used to transform JavaScript. 

And... if we use babel, we need another config file to tell what we actually want to transform.

**opra you get a config file, and you get a conifg file**


## In babel land

The least complicated way to do this is to simply at a `.babelrc` file in your repo like this:

```json
{
  "presets": ["@babel/preset-env"]
}
```

That will work since in normal Laravel installs, `laravel-mix`, the mothership Laravel asset building,  takes care of everything, and it is ignoring this file. If you want to only add transformations for testing, do it like this, even though it is not necessary in most cases.:

```json
{
    "env": {
        "test": {
            "presets": [
                [
                    "@babel/preset-env"
                ]
            ]
        }
    }
}
```

This tells `babel-jest` and `vue-jest`: "Be a good kid and transform all the test code we write before testing. Use the things this preset of `babel` to make it as compatible as possible - and please just work".

I'll leave it at that, we would actually only need a few select plugins and not a whole preset, but this post is nerdy enough.

## Just oooone more thing

We are almost there I promise. The last problem we have to solve is that newer version of `jest` as well as `laravel-mix` use a newer version of `babel` that is incopatbile with `vue-jest`. I'll make it short, there is a plugin for that, called `bable-bridge` described in the `vue-jest` **link**docs.

    
```bash
npm install --save-dev babel-core@bridge
```

And believe it or not, we can **finally** write our first test.

## The first test

- create first test and vue compoenten under test
- Nothing works, why? 


- Getting special
    - It is hard to compile
    - Vue jest needs babel needs babel jest, needs babel config
    
- Example files
- Example project

- What the package will do
- Summary




